var notes=notes||{};notes=function(n){function a(e){return e.split(" ")}function o(e){return a(e).pop()}function i(e){var t=e.serializeArray(),o={};return n.map(t,function(e,t){o[e.name]=e.value}),o}n("#notebook").autocomplete({source:"/search/notebook",minLength:3}),n("#tags").autocomplete({source:function(e,t){n.getJSON("/search/tags",{term:o(e.term)},t)},search:function(){if(o(this.value).length<3)return!1},focus:function(){return!1},select:function(e,t){var o=a(this.value);return o.pop(),o.push(t.item.value),o.push(""),this.value=o.join(" "),!1}}),n('[data-toggle="popover"]').popover(),n('[data-toggle="tooltip"]').tooltip({boundary:"window"}),n("[data-href]").click(function(){var e=n(this).data("href");location.href=e}),n("#selectAll").click(function(){n("input[name=id][type=checkbox]").prop("checked",function(){return!!n("#selectAll").is(":checked")})}),n("#trashSubmit").click(function(){var e=n("#trash").data("id");n.ajax({type:"POST",url:"/note/remove/"+e}).done(function(){location.href="/"}).fail(function(){n("#error").html('<div class="alert alert-danger">Failed to delete or restore note!</div>')})}),n("#delAccountSubmit").click(function(){var e=n("#delAccount").data("id");n.ajax({type:"POST",url:"/admin/account/delete/"+e}).done(function(e){null!=e&&!1===e.success?n("#error").html('<div class="alert alert-danger">'+e.error+"</div>"):location.href="/admin/account/"}).fail(function(){n("#error").html('<div class="alert alert-danger">Failed to delete account!</div>')})}),n("#saveContinue").click(function(){if(n("#note-form").valid()){var e=i(n("#note-form"));n.ajax({type:"POST",url:"/note/edit/",dataType:"json",data:e}).done(function(e){null!=e&&e.success?(n("#id").val(e.id),n("#result").html('<div class="alert alert-success"><button type="button" class="close">×</button>Note has been successfully saved.</div>'),window.setTimeout(function(){n(".alert").fadeTo(500,0).slideUp(500,function(){n(this).remove()})},5e3),n(".alert .close").on("click",function(e){n(this).parent().fadeTo(500,0).slideUp(500)})):t()}).fail(function(){t()})}var t=function(){n("#result").html('<div class="alert alert-danger"><button type="button" class="close">×</button>Failed to save note!</div>'),n(".alert .close").on("click",function(e){n(this).parent().fadeTo(500,0).slideUp(500)})}}),n("#preview").click(function(){if(n("#editor-source").is(":visible")){var t=i(n("#note-form"));n.ajax({type:"POST",url:"/note/preview/",dataType:"json",data:t}).done(function(e){null!=t?(n("#editor-preview").html(e.content),n("#preview").html('<i class="fa fa-pencil"></i> Edit'),n("#editor-source").toggle(),n("#editor-preview").toggle()):o()}).fail(function(){o()});var o=function(){n("#result").html('<div class="alert alert-danger"><button type="button" class="close">×</button>Failed to generate preview!</div>'),n(".alert .close").on("click",function(e){n(this).parent().fadeTo(500,0).slideUp(500)})}}else n("#preview").html('<i class="fa fa-eye"></i> Preview'),n("#editor-source").toggle(),n("#editor-preview").toggle()}),n("#help").click(function(){n("#editor-help").slideToggle()}),n.validator.setDefaults({highlight:function(e){n(e).addClass("is-invalid")},unhighlight:function(e){n(e).removeClass("is-invalid")}}),n.validator.addMethod("regex",function(e,t,o){return this.optional(t)||e.match(o)},"This field has the wrong format."),n.validator.addMethod("nowhitespace",function(e,t){return this.optional(t)||""!=e.trim()},"This field is required."),n.validator.addMethod("stringarrayitemmaxlength",function(e,t,o){for(var n=e.split(" "),a=0;a<n.length;a++)if(n[a].trim().length>o)return!1;return!0},"Length of word too long."),n("#login-form").validate({rules:{username:{required:!0,nowhitespace:!0,email:!0},password:{required:!0,nowhitespace:!0,minlength:8}}}),n("#forgot-form").validate({rules:{username:{required:!0,nowhitespace:!0,email:!0}}}),n("#reset-form").validate({rules:{newpassword:{required:!0,nowhitespace:!0,minlength:8},confirmpassword:{required:!0,nowhitespace:!0,minlength:8,equalTo:"#newpassword"}},messages:{confirmpassword:{equalTo:"The passwords doesn't match."}}}),n("#note-form").validate({rules:{title:{required:!0,nowhitespace:!0,maxlength:100},content:{required:!0,nowhitespace:!0},notebook:{maxlength:50},tags:{stringarrayitemmaxlength:50}},messages:{tags:{stringarrayitemmaxlength:"Tag too long."}}}),n("#settings-form").validate({rules:{displayname:{nowhitespace:!0,maxlength:50},items:{required:!0,nowhitespace:!0,min:1,max:100}}}),n("#security-form").validate({rules:{oldpassword:{required:!0,nowhitespace:!0,minlength:8},newpassword:{required:!0,nowhitespace:!0,minlength:8},confirmpassword:{required:!0,nowhitespace:!0,minlength:8,equalTo:"#newpassword"}},messages:{confirmpassword:{equalTo:"The passwords doesn't match."}}}),n("#account-form").validate({rules:{username:{required:!0,email:!0},password:{minlength:8},displayname:{nowhitespace:!0,maxlength:50}}})}(jQuery);