var notes=notes||{};notes=function(e){function t(e){return e.split(" ")}function i(e){return t(e).pop()}function o(t){var i=t.serializeArray(),o={};return e.map(i,function(e,t){o[e.name]=e.value}),o}e("#notebook").autocomplete({source:"/search/notebook",minLength:3}),e("#tags").autocomplete({source:function(t,o){e.getJSON("/search/tags",{term:i(t.term)},o)},search:function(){if(i(this.value).length<3)return!1},focus:function(){return!1},select:function(e,i){var o=t(this.value);return o.pop(),o.push(i.item.value),o.push(""),this.value=o.join(" "),!1}}),e("[data-toggle=popover]").popover(),e("[data-href]").click(function(){var t=e(this).data("href");location.href=t}),e("#selectAll").click(function(){e("input[name=id][type=checkbox]").prop("checked",function(){return!!e("#selectAll").is(":checked")})}),e("#trashSubmit").click(function(){var t=e("#trash").data("id");e.ajax({type:"POST",url:"/note/remove/"+t}).done(function(){location.href="/"}).fail(function(){e("#error").html('<div class="alert alert-danger">Failed to delete or restore note!</div>')})}),e("#delAccountSubmit").click(function(){var t=e("#delAccount").data("id");e.ajax({type:"POST",url:"/admin/account/delete/"+t}).done(function(t){null!=t&&!1===t.success?e("#error").html('<div class="alert alert-danger">'+t.error+"</div>"):location.href="/admin/account/"}).fail(function(){e("#error").html('<div class="alert alert-danger">Failed to delete account!</div>')})}),e("#saveContinue").click(function(){if(e("#note-form").valid()){var t=o(e("#note-form"));e.ajax({type:"POST",url:"/note/edit/",dataType:"json",data:t}).done(function(t){null!=t&&t.success?(e("#id").val(t.id),e("#result").html('<div class="alert alert-success"><button type="button" class="close">×</button>Note has been successfully saved.</div>'),window.setTimeout(function(){e(".alert").fadeTo(500,0).slideUp(500,function(){e(this).remove()})},5e3),e(".alert .close").on("click",function(t){e(this).parent().fadeTo(500,0).slideUp(500)})):i()}).fail(function(){i()})}var i=function(){e("#result").html('<div class="alert alert-danger"><button type="button" class="close">×</button>Failed to save note!</div>'),e(".alert .close").on("click",function(t){e(this).parent().fadeTo(500,0).slideUp(500)})}}),e("#preview").click(function(){if(e("#editor-source").is(":visible")){var t=o(e("#note-form"));e.ajax({type:"POST",url:"/note/preview/",dataType:"json",data:t}).done(function(o){null!=t?(e("#editor-preview").html(o.content),e("#preview").html('<i class="fa fa-pencil"></i> Edit'),e("#editor-source").toggle(),e("#editor-preview").toggle()):i()}).fail(function(){i()});var i=function(){e("#result").html('<div class="alert alert-danger"><button type="button" class="close">×</button>Failed to generate preview!</div>'),e(".alert .close").on("click",function(t){e(this).parent().fadeTo(500,0).slideUp(500)})}}else e("#preview").html('<i class="fa fa-eye"></i> Preview'),e("#editor-source").toggle(),e("#editor-preview").toggle()}),e("#help").click(function(){e("#editor-help").slideToggle()}),e.validator.setDefaults({highlight:function(t){e(t).addClass("is-invalid")},unhighlight:function(t){e(t).removeClass("is-invalid")}}),e.validator.addMethod("regex",function(e,t,i){return this.optional(t)||e.match(i)},"This field has the wrong format."),e.validator.addMethod("nowhitespace",function(e,t){return this.optional(t)||""!=e.trim()},"This field is required."),e("#login-form").validate({rules:{username:{required:!0,nowhitespace:!0,email:!0},password:{required:!0,nowhitespace:!0,minlength:8}}}),e("#forgot-form").validate({rules:{username:{required:!0,nowhitespace:!0,email:!0}}}),e("#reset-form").validate({rules:{newpassword:{required:!0,nowhitespace:!0,minlength:8},confirmpassword:{required:!0,nowhitespace:!0,minlength:8,equalTo:"#newpassword"}},messages:{confirmpassword:{equalTo:"The passwords doesn't match."}}}),e("#note-form").validate({rules:{title:{required:!0,nowhitespace:!0},content:{required:!0,nowhitespace:!0}}}),e("#settings-form").validate({rules:{items:{required:!0,nowhitespace:!0,min:1,max:100}}}),e("#security-form").validate({rules:{oldpassword:{required:!0,nowhitespace:!0,minlength:8},newpassword:{required:!0,nowhitespace:!0,minlength:8},confirmpassword:{required:!0,nowhitespace:!0,minlength:8,equalTo:"#newpassword"}},messages:{confirmpassword:{equalTo:"The passwords doesn't match."}}}),e("#account-form").validate({rules:{username:{required:!0,email:!0},password:{minlength:8},displayname:{nowhitespace:!0}}})}(jQuery);