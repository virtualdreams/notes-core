var notes=notes||{},notes=function(o){function i(e){return e.split(" ")}function a(e){return i(e).pop()}o("#notebook").autocomplete({source:"/search/notebook",minLength:3}),o("#tags").autocomplete({source:function(e,t){o.getJSON("/search/tags",{term:a(e.term)},t)},search:function(){if(a(this.value).length<3)return!1},focus:function(){return!1},select:function(e,t){var a=i(this.value);return a.pop(),a.push(t.item.value),a.push(""),this.value=a.join(" "),!1}});[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)}),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)});function r(e){var e=e.serializeArray(),a={};return o.map(e,function(e,t){a[e.name]=e.value}),a}o("#selectAll").click(function(){o("input[name=id][type=checkbox]").prop("checked",function(){return!!o("#selectAll").is(":checked")})}),o("#trashSubmit").click(function(){var e=o("#trash").data("id");o.ajax({type:"POST",url:"/note/remove/"+e}).done(function(){location.href="/"}).fail(function(){o("#error").html('<div class="alert alert-danger">Failed to delete or restore note!</div>')})}),o("#delAccountSubmit").click(function(){var e=o("#delAccount").data("id");o.ajax({type:"POST",url:"/admin/account/delete/"+e}).done(function(e){null!=e&&!1===e.success?o("#error").html('<div class="alert alert-danger">'+e.error+"</div>"):location.href="/admin/account/"}).fail(function(){o("#error").html('<div class="alert alert-danger">Failed to delete account!</div>')})}),o("#saveContinue").click(function(){o("#note-form").valid()&&(e=r(o("#note-form")),o.ajax({type:"POST",url:"/note/edit/",dataType:"json",data:e}).done(function(e){null!=e&&e.success?(o("#id").val(e.id),o("#result").html('<div class="alert alert-success alert-dismissible fade show">Note has been successfully saved.<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>')):t()}).fail(function(){t()}));var e,t=function(){o("#result").html('<div class="alert alert-danger alert-dismissible fade show">Failed to save note!<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>')}}),o("#preview").click(function(){var t,a;o("#editor-source").is(":visible")?(t=r(o("#note-form")),o.ajax({type:"POST",url:"/note/preview/",dataType:"json",data:t}).done(function(e){null!=t?(o("#preview-content").html(e.content),o("#preview").html('<i class="fa fa-pencil"></i> Edit'),o("#editor-source").toggle(),o("#editor-preview").toggle()):a()}).fail(function(){a()}),a=function(){o("#result").html('<div class="alert alert-danger alert-dismissible fade show">Failed to generate preview!<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>')}):(o("#preview").html('<i class="fa fa-eye"></i> Preview'),o("#editor-source").toggle(),o("#editor-preview").toggle())}),o("#help").click(function(){o("#editor-help").slideToggle()}),o.validator.setDefaults({highlight:function(e){o(e).addClass("is-invalid")},unhighlight:function(e){o(e).removeClass("is-invalid")}}),o.validator.addMethod("regex",function(e,t,a){return this.optional(t)||e.match(a)},"This field has the wrong format."),o.validator.addMethod("nowhitespace",function(e,t){return this.optional(t)||""!=e.trim()},"This field is required."),o.validator.addMethod("stringarrayitemmaxlength",function(e,t,a){for(var o=e.split(" "),i=0;i<o.length;i++)if(o[i].trim().length>a)return!1;return!0},"Length of word too long."),o("#login-form").validate({rules:{username:{required:!0,nowhitespace:!0,email:!0},password:{required:!0,nowhitespace:!0}}}),o("#forgot-form").validate({rules:{username:{required:!0,nowhitespace:!0,email:!0}}}),o("#reset-form").validate({rules:{newpassword:{required:!0,nowhitespace:!0},confirmpassword:{required:!0,nowhitespace:!0,equalTo:"#newpassword"}},messages:{confirmpassword:{equalTo:"The passwords doesn't match."}}}),o("#note-form").validate({rules:{title:{required:!0,nowhitespace:!0,maxlength:100},content:{required:!0,nowhitespace:!0},notebook:{maxlength:50},tags:{stringarrayitemmaxlength:50}},messages:{tags:{stringarrayitemmaxlength:"Tag too long."}}}),o("#settings-form").validate({rules:{displayname:{nowhitespace:!0,maxlength:50},items:{required:!0,nowhitespace:!0,min:1,max:100}}}),o("#security-form").validate({rules:{oldpassword:{required:!0,nowhitespace:!0},newpassword:{required:!0,nowhitespace:!0},confirmpassword:{required:!0,nowhitespace:!0,equalTo:"#newpassword"}},messages:{confirmpassword:{equalTo:"The passwords doesn't match."}}}),o("#account-form").validate({rules:{username:{required:!0,email:!0},displayname:{nowhitespace:!0,maxlength:50}}})}(jQuery);