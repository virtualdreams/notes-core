var notes=notes||{},notes=function(a){function n(e){return e.split(" ")}function o(e){return n(e).pop()}a("#notebook").autocomplete({source:"/search/notebook",minLength:3}),a("#tags").autocomplete({source:function(e,t){a.getJSON("/search/tags",{term:o(e.term)},t)},search:function(){if(o(this.value).length<3)return!1},focus:function(){return!1},select:function(e,t){var o=n(this.value);return o.pop(),o.push(t.item.value),o.push(""),this.value=o.join(" "),!1}});[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)}),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)});function i(e){var e=e.serializeArray(),o={};return a.map(e,function(e,t){o[e.name]=e.value}),o}a("[data-href]").click(function(){var e=a(this).data("href");location.href=e}),a("#selectAll").click(function(){a("input[name=id][type=checkbox]").prop("checked",function(){return!!a("#selectAll").is(":checked")})}),a("#trashSubmit").click(function(){var e=a("#trash").data("id");a.ajax({type:"POST",url:"/note/remove/"+e}).done(function(){location.href="/"}).fail(function(){a("#error").html('<div class="alert alert-danger">Failed to delete or restore note!</div>')})}),a("#delAccountSubmit").click(function(){var e=a("#delAccount").data("id");a.ajax({type:"POST",url:"/admin/account/delete/"+e}).done(function(e){null!=e&&!1===e.success?a("#error").html('<div class="alert alert-danger">'+e.error+"</div>"):location.href="/admin/account/"}).fail(function(){a("#error").html('<div class="alert alert-danger">Failed to delete account!</div>')})}),a("#saveContinue").click(function(){var e;a("#note-form").valid()&&(e=i(a("#note-form")),a.ajax({type:"POST",url:"/note/edit/",dataType:"json",data:e}).done(function(e){null!=e&&e.success?(a("#id").val(e.id),a("#result").html('<div class="alert alert-success"><button type="button" class="close">×</button>Note has been successfully saved.</div>'),window.setTimeout(function(){a(".alert").fadeTo(500,0).slideUp(500,function(){a(this).remove()})},5e3),a(".alert .close").on("click",function(e){a(this).parent().fadeTo(500,0).slideUp(500)})):t()}).fail(function(){t()}));var t=function(){a("#result").html('<div class="alert alert-danger"><button type="button" class="close">×</button>Failed to save note!</div>'),a(".alert .close").on("click",function(e){a(this).parent().fadeTo(500,0).slideUp(500)})}}),a("#preview").click(function(){var t,o;a("#editor-source").is(":visible")?(t=i(a("#note-form")),a.ajax({type:"POST",url:"/note/preview/",dataType:"json",data:t}).done(function(e){null!=t?(a("#preview-content").html(e.content),a("#preview").html('<i class="fa fa-pencil"></i> Edit'),a("#editor-source").toggle(),a("#editor-preview").toggle()):o()}).fail(function(){o()}),o=function(){a("#result").html('<div class="alert alert-danger"><button type="button" class="close">×</button>Failed to generate preview!</div>'),a(".alert .close").on("click",function(e){a(this).parent().fadeTo(500,0).slideUp(500)})}):(a("#preview").html('<i class="fa fa-eye"></i> Preview'),a("#editor-source").toggle(),a("#editor-preview").toggle())}),a("#help").click(function(){a("#editor-help").slideToggle()}),a.validator.setDefaults({highlight:function(e){a(e).addClass("is-invalid")},unhighlight:function(e){a(e).removeClass("is-invalid")}}),a.validator.addMethod("regex",function(e,t,o){return this.optional(t)||e.match(o)},"This field has the wrong format."),a.validator.addMethod("nowhitespace",function(e,t){return this.optional(t)||""!=e.trim()},"This field is required."),a.validator.addMethod("stringarrayitemmaxlength",function(e,t,o){for(var a=e.split(" "),n=0;n<a.length;n++)if(a[n].trim().length>o)return!1;return!0},"Length of word too long."),a("#login-form").validate({rules:{username:{required:!0,nowhitespace:!0,email:!0},password:{required:!0,nowhitespace:!0}}}),a("#forgot-form").validate({rules:{username:{required:!0,nowhitespace:!0,email:!0}}}),a("#reset-form").validate({rules:{newpassword:{required:!0,nowhitespace:!0},confirmpassword:{required:!0,nowhitespace:!0,equalTo:"#newpassword"}},messages:{confirmpassword:{equalTo:"The passwords doesn't match."}}}),a("#note-form").validate({rules:{title:{required:!0,nowhitespace:!0,maxlength:100},content:{required:!0,nowhitespace:!0},notebook:{maxlength:50},tags:{stringarrayitemmaxlength:50}},messages:{tags:{stringarrayitemmaxlength:"Tag too long."}}}),a("#settings-form").validate({rules:{displayname:{nowhitespace:!0,maxlength:50},items:{required:!0,nowhitespace:!0,min:1,max:100}}}),a("#security-form").validate({rules:{oldpassword:{required:!0,nowhitespace:!0},newpassword:{required:!0,nowhitespace:!0},confirmpassword:{required:!0,nowhitespace:!0,equalTo:"#newpassword"}},messages:{confirmpassword:{equalTo:"The passwords doesn't match."}}}),a("#account-form").validate({rules:{username:{required:!0,email:!0},displayname:{nowhitespace:!0,maxlength:50}}})}(jQuery);